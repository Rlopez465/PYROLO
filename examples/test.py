dump1 = """0000000000 e9 07 0a c5 02 12 1c 69 43 6c 6f 75 64 2e 64 65   .......iCloud.de
0000000010 76 2e 6a 6a 74 65 63 68 2e 74 65 73 74 2e 61 67   v.jjtech.test.ag
0000000020 61 69 6e 1a 1d 64 65 76 2e 6a 6a 74 65 63 68 2e   ain..dev.jjtech.
0000000030 65 78 70 65 72 69 6d 65 6e 74 73 2e 63 6b 74 65   experiments.ckte
0000000040 73 74 22 01 31 3a 28 0a 24 45 41 35 31 30 38 45   st".1:(.$EA5108E
0000000050 32 2d 30 42 37 37 2d 34 43 38 33 2d 38 43 42 44   2-0B77-4C83-8CBD
0000000060 2d 41 35 44 39 44 42 35 42 46 35 38 42 10 02 42   -A5D9DB5BF58B..B
0000000070 06 31 33 2e 34 2e 31 4a 0e 4d 61 63 42 6f 6f 6b   .13.4.1J.MacBook
0000000080 50 72 6f 31 38 2c 33 52 21 63 6f 6d 2e 61 70 70   Pro18,3R!com.app
0000000090 6c 65 2e 63 6c 6f 75 64 6b 69 74 2e 43 6c 6f 75   le.cloudkit.Clou
00000000a0 64 4b 69 74 44 61 65 6d 6f 6e 5a 07 32 30 36 30   dKitDaemonZ.2060
00000000b0 2e 31 31 92 01 03 35 2e 30 98 01 02 aa 01 10 4a   .11...5.0......J
00000000c0 61 6d 65 73 e2 80 99 73 20 4c 61 70 74 6f 70 b2   ames...s Laptop.
00000000d0 01 24 45 41 35 31 30 38 45 32 2d 30 42 37 37 2d   .$EA5108E2-0B77-
00000000e0 34 43 38 33 2d 38 43 42 44 2d 41 35 44 39 44 42   4C83-8CBD-A5D9DB
00000000f0 35 42 46 35 38 42 b8 01 02 c8 01 01 d2 01 0e 45   5BF58B.........E
0000000100 70 68 65 6d 65 72 61 6c 47 72 6f 75 70 e8 01 00   phemeralGroup...
0000000110 82 02 24 37 42 34 30 42 33 37 44 2d 32 35 30 33   ..$7B40B37D-2503
0000000120 2d 35 31 36 31 2d 39 42 34 45 2d 38 34 44 32 30   -5161-9B4E-84D20
0000000130 34 37 38 36 39 34 43 8a 02 0a 58 35 54 30 51 46   478694C...X5T0QF
0000000140 4e 48 58 50 90 02 00 98 02 02 12 2b 0a 24 36 38   NHXP.......+.$68
0000000150 37 33 42 35 36 34 2d 30 43 36 39 2d 34 44 43 34   73B564-0C69-4DC4
0000000160 2d 41 33 30 36 2d 35 30 43 38 38 39 37 37 31 39   -A306-50C8897719
0000000170 38 39 10 e6 01 20 01 b2 0e f0 04 22 dc 01 0a 53   89... ....."...S
0000000180 0a 28 0a 24 34 34 45 41 37 30 36 44 2d 45 32 32   .(.$44EA706D-E22
0000000190 42 2d 34 35 33 37 2d 41 35 41 32 2d 39 33 36 38   B-4537-A5A2-9368
00000001a0 31 30 31 36 35 45 43 41 10 01 12 27 0a 10 0a 0c   10165ECA...'....
00000001b0 5f 64 65 66 61 75 6c 74 5a 6f 6e 65 10 06 12 11   _defaultZone....
00000001c0 0a 0d 5f 64 65 66 61 75 6c 74 4f 77 6e 65 72 10   .._defaultOwner.
00000001d0 07 18 02 12 0a 0a 08 54 6f 44 6f 49 74 65 6d 1a   .......ToDoItem.
00000001e0 79 0a 06 0a 04 74 65 73 74 12 6f 12 15 01 a8 f2   y....test.o.....
00000001f0 f0 59 78 ab 7f 23 9b 22 bc ce 48 f8 8b 0c c7 66   .Yx..#."..H....f
0000000200 1c 61 20 84 03 52 53 0a 28 0a 24 34 34 45 41 37   .a ..RS.(.$44EA7
0000000210 30 36 44 2d 45 32 32 42 2d 34 35 33 37 2d 41 35   06D-E22B-4537-A5
0000000220 41 32 2d 39 33 36 38 31 30 31 36 35 45 43 41 10   A2-936810165ECA.
0000000230 01 12 27 0a 10 0a 0c 5f 64 65 66 61 75 6c 74 5a   ..'...._defaultZ
0000000240 6f 6e 65 10 06 12 11 0a 0d 5f 64 65 66 61 75 6c   one......_defaul
0000000250 74 4f 77 6e 65 72 10 07 18 02 2a 21 0a 1a 78 2d   tOwner....*!..x-
0000000260 61 70 70 6c 65 2d 6d 6d 63 73 2d 70 72 6f 74 6f   apple-mmcs-proto
0000000270 2d 76 65 72 73 69 6f 6e 12 03 35 2e 30 2a 49 0a   -version..5.0*I.
0000000280 19 78 2d 61 70 70 6c 65 2d 6d 6d 63 73 2d 70 6c   .x-apple-mmcs-pl
0000000290 69 73 74 2d 73 68 61 32 35 36 12 2c 66 76 6a 30   ist-sha256.,fvj0
00000002a0 59 2f 59 62 75 31 70 71 30 72 34 4e 78 58 77 33   Y/Ybu1pq0r4NxXw3
00000002b0 65 50 35 31 65 78 75 6a 55 6b 45 41 64 37 4c 6c   eP51exujUkEAd7Ll
00000002c0 6c 62 6b 54 64 4b 38 3d 2a 22 0a 1a 78 2d 61 70   lbkTdK8=*"..x-ap
00000002d0 70 6c 65 2d 6d 6d 63 73 2d 70 6c 69 73 74 2d 76   ple-mmcs-plist-v
00000002e0 65 72 73 69 6f 6e 12 04 76 31 2e 30 2a 7d 0a 11   ersion..v1.0*}..
00000002f0 78 2d 6d 6d 65 2d 63 6c 69 65 6e 74 2d 69 6e 66   x-mme-client-inf
0000000300 6f 12 68 3c 4d 61 63 42 6f 6f 6b 50 72 6f 31 38   o.h<MacBookPro18
0000000310 2c 33 3e 20 3c 6d 61 63 4f 53 3b 31 33 2e 34 2e   ,3> <macOS;13.4.
0000000320 31 3b 32 32 46 38 32 3e 20 3c 63 6f 6d 2e 61 70   1;22F82> <com.ap
0000000330 70 6c 65 2e 69 63 6c 6f 75 64 2e 63 6f 6e 74 65   ple.icloud.conte
0000000340 6e 74 2f 32 30 35 30 2e 31 33 2e 31 2e 31 20 28   nt/2050.13.1.1 (
0000000350 63 6f 6d 2e 61 70 70 6c 65 2e 43 6c 6f 75 64 4b   com.apple.CloudK
0000000360 69 74 2f 28 6e 75 6c 6c 29 29 3e 32 7c 0a 78 0a   it/(null))>2|.x.
0000000370 15 01 a8 f2 f0 59 78 ab 7f 23 9b 22 bc ce 48 f8   .....Yx..#."..H.
0000000380 8b 0c c7 66 1c 61 12 00 1a 2d 0a 15 81 60 83 0f   ...f.a...-...`..
0000000390 fe 89 09 15 35 1f af 90 3f de da c9 ad 36 5c 70   ....5...?....6\p
00000003a0 02 12 11 01 10 78 a8 01 42 ef cd 82 bb a8 06 92   .....x..B.......
00000003b0 10 d4 32 a5 18 84 03 42 2e 08 01 aa 06 13 6b 43   ..2....B......kC
00000003c0 4b 50 72 6f 66 69 6c 65 54 79 70 65 52 61 62 69   KProfileTypeRabi
00000003d0 6e b2 06 0a 32 30 32 32 2d 30 38 2d 31 31 b8 06   n...2022-08-11..
00000003e0 01 c2 06 03 72 74 66 18 51 40 01                  ....rtf.Q@.
"""

dump2 = """0000000000 a7 05 0a 56 12 24 69 43 6c 6f 75 64 2e 64 65 76   ...V.$iCloud.dev
0000000010 2e 6a 6a 74 65 63 68 2e 65 78 70 65 72 69 6d 65   .jjtech.experime
0000000020 6e 74 73 2e 63 6b 74 65 73 74 98 01 02 b2 01 24   nts.cktest.....$
0000000030 36 32 42 46 43 39 35 46 2d 44 38 44 35 2d 34 46   62BFC95F-D8D5-4F
0000000040 30 36 2d 42 41 44 37 2d 31 35 45 42 41 39 38 30   06-BAD7-15EBA980
0000000050 43 36 43 43 b8 01 02 c8 01 01 12 2b 0a 24 32 33   C6CC.......+.$23
0000000060 31 43 43 43 31 39 2d 38 36 43 45 2d 34 41 34 46   1CCC19-86CE-4A4F
0000000070 2d 39 38 42 33 2d 45 33 45 38 37 31 32 30 36 30   -98B3-E3E8712060
0000000080 43 45 10 e6 01 20 01 b2 0e 9e 04 22 89 01 0a 37   CE... ....."...7
0000000090 0a 0e 0a 0a 74 65 73 74 61 73 73 73 65 74 10 01   ....testassset..
00000000a0 12 25 0a 10 0a 0c 5f 64 65 66 61 75 6c 74 5a 6f   .%...._defaultZo
00000000b0 6e 65 10 06 12 11 0a 0d 5f 64 65 66 61 75 6c 74   ne......_default
00000000c0 4f 77 6e 65 72 10 07 12 06 0a 04 74 65 73 74 1a   Owner......test.
00000000d0 46 0a 06 0a 04 74 65 73 74 12 3c 20 84 03 52 37   F....test.< ..R7
00000000e0 0a 0e 0a 0a 74 65 73 74 61 73 73 73 65 74 10 01   ....testassset..
00000000f0 12 25 0a 10 0a 0c 5f 64 65 66 61 75 6c 74 5a 6f   .%...._defaultZo
0000000100 6e 65 10 06 12 11 0a 0d 5f 64 65 66 61 75 6c 74   ne......_default
0000000110 4f 77 6e 65 72 10 07 2a 21 0a 1a 78 2d 61 70 70   Owner..*!..x-app
0000000120 6c 65 2d 6d 6d 63 73 2d 70 72 6f 74 6f 2d 76 65   le-mmcs-proto-ve
0000000130 72 73 69 6f 6e 12 03 35 2e 30 2a 49 0a 19 78 2d   rsion..5.0*I..x-
0000000140 61 70 70 6c 65 2d 6d 6d 63 73 2d 70 6c 69 73 74   apple-mmcs-plist
0000000150 2d 73 68 61 32 35 36 12 2c 66 76 6a 30 59 2f 59   -sha256.,fvj0Y/Y
0000000160 62 75 31 70 71 30 72 34 4e 78 58 77 33 65 50 35   bu1pq0r4NxXw3eP5
0000000170 31 65 78 75 6a 55 6b 45 41 64 37 4c 6c 6c 62 6b   1exujUkEAd7Lllbk
0000000180 54 64 4b 38 3d 2a 22 0a 1a 78 2d 61 70 70 6c 65   TdK8=*"..x-apple
0000000190 2d 6d 6d 63 73 2d 70 6c 69 73 74 2d 76 65 72 73   -mmcs-plist-vers
00000001a0 69 6f 6e 12 04 76 31 2e 30 2a 7e 0a 12 78 78 2d   ion..v1.0*~..xx-
00000001b0 6d 6d 65 2d 63 6c 69 65 6e 74 2d 69 6e 66 6f 12   mme-client-info.
00000001c0 68 3c 4d 61 63 42 6f 6f 6b 50 72 6f 31 38 2c 33   h<MacBookPro18,3
00000001d0 3e 20 3c 6d 61 63 4f 53 3b 31 33 2e 34 2e 31 3b   > <macOS;13.4.1;
00000001e0 32 32 46 38 32 3e 20 3c 63 6f 6d 2e 61 70 70 6c   22F82> <com.appl
00000001f0 65 2e 69 63 6c 6f 75 64 2e 63 6f 6e 74 65 6e 74   e.icloud.content
0000000200 2f 32 30 35 30 2e 31 33 2e 31 2e 31 20 28 63 6f   /2050.13.1.1 (co
0000000210 6d 2e 61 70 70 6c 65 2e 43 6c 6f 75 64 4b 69 74   m.apple.CloudKit
0000000220 2f 28 6e 75 6c 6c 29 29 3e 32 7c 0a 78 0a 15 01   /(null))>2|.x...
0000000230 a8 f2 f0 59 78 ab 7f 23 9b 22 bc ce 48 f8 8b 0c   ...Yx..#."..H...
0000000240 c7 66 1c 61 12 00 1a 2d 0a 15 81 60 83 0f fe 89   .f.a...-...`....
0000000250 09 15 35 1f af 90 3f de da c9 ad 36 5c 70 02 12   ..5...?....6\p..
0000000260 11 01 75 a7 d4 5c 07 2f 14 f5 28 03 93 19 65 7e   ..u..\./..(...e~
0000000270 a6 d6 18 84 03 42 2e 08 01 aa 06 13 6b 43 4b 50   .....B......kCKP
0000000280 72 6f 66 69 6c 65 54 79 70 65 52 61 62 69 6e b2   rofileTypeRabin.
0000000290 06 0a 32 30 32 32 2d 30 38 2d 31 31 b8 06 01 c2   ..2022-08-11....
00000002a0 06 03 72 74 66 18 51 40 01                        ..rtf.Q@.
"""
# 2 is bad
dump = dump1
# # Parse the hexdump in bytes
# # Split into lines
lines = dump.split("\n")

# Remove the address column
lines = [line[10:] for line in lines]
# Remove the ascii column
lines = [line[:49] for line in lines]
# Remove the spaces
lines = [line.replace(" ", "") for line in lines]
# Join the lines
lines = "".join(lines)
# Convert to bytes
lines = bytes.fromhex(lines)
# Print base64
import base64
print(base64.b64encode(lines[2:]).decode())
print(lines[:2].hex())

import sys
sys.path.append(".")
import icloud.cloudkit_pb2 as cloudkit_pb2
request = cloudkit_pb2.RequestOperation()
request.ParseFromString(lines[2:])
print(request)
# import plistlib
#print(plistlib.loads(request.recordSaveRequest.record.recordField[1].value.bytesValue))
print(request.assetUploadTokenRetrieveRequest.authorizePut.data.chunks[0].chunk_encryption_key.hex())
#print(request.assetUploadTokenRetrieveRequest.authorizePut.data.sig.hex())


# #print(len(lines[2:]))
# #print(int.from_bytes(lines[:2], 'little'))
# #import struct
# # len_bytes = struct.pack('>L', len(lines[2:]))
# # print(len_bytes.hex())
# # print(len(lines[2:]))

key = bytes.fromhex("10 78 a8 01 42 ef cd 82 bb a8 06 92 10 d4 32 a5")
#from crypto.aes import AESencryptCBC, AESdecryptCBC, AESdecryptCFB
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes

def AESdecryptCFB(key, data):
    iv = 16 * b'\x00'
    cipher = Cipher(algorithms.AES(key), modes.CFB(iv))
    decryptor = cipher.decryptor()
    return decryptor.update(data) + decryptor.finalize()

with open("/Users/jjtech/Downloads/cCo6ruABi13kXf4ClLri", "rb") as f:
    data = f.read()

print(AESdecryptCFB(key, data).decode())
